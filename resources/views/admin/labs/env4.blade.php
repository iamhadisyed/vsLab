@extends('adminlte::layouts.app')

{{--@section('head_css')--}}
{{--<link rel="stylesheet" href="{{ URL::asset('packages/vis/dist/vis.css') }}" />--}}
{{--@endsection--}}

@section('htmlheader_title')
    Workspace
    {{--{{ trans('message.role') }}--}}
@endsection

@section('contentheader_title')
    CS4663 Workspace
@endsection

@section('contentheader_description')
    Task Detail
@endsection

@section('main-content')
    <div class="container-fluid spark-screen">
        <div class="row">
            <div id="labcontent" class="col-md-6 resizable">
                <div class="box box-solid">
                    <div class="box-header with-border">
                        {{--<h3 class="box-title">Iptables Firewall Setup</h3>--}}
                        <div class="bs-wizard" style="border-bottom:0;">

                            <div id="bs-wizard-step-200" class="col-xs-3 bs-wizard-step ">
                                <div class="text-center bs-wizard-stepnum">Intro</div>
                                <div class="progress"><div class="progress-bar"></div></div>
                                <a href="#task_200" class="bs-wizard-dot" onclick="active_bar_step(this)" title="Submission 1"></a>
                            </div>


                            <div id="bs-wizard-step-201" class="col-xs-3 bs-wizard-step">
                                <div class="text-center bs-wizard-stepnum">Task 1</div>
                                <div class="progress"><div class="progress-bar"></div></div>
                                <a href="#task_201" class="bs-wizard-dot" onclick="active_bar_step(this)"></a>
                            </div>

                            <div id="bs-wizard-step-202" class="col-xs-3 bs-wizard-step">
                                <div class="text-center bs-wizard-stepnum">Task 2</div>
                                <div class="progress"><div class="progress-bar"></div></div>
                                <a href="#task_202" class="bs-wizard-dot" onclick="active_bar_step(this)"></a>
                            </div>

                            <div id="bs-wizard-step-203" class="col-xs-3 bs-wizard-step">
                                <div class="text-center bs-wizard-stepnum">Task 3</div>
                                <div class="progress"><div class="progress-bar"></div></div>
                                <a href="#task_203" class="bs-wizard-dot" onclick="active_bar_step(this)"></a>
                            </div>



                        </div>
                        <button style="float: right" onclick="close_content();">Close</button>
                    </div>
                    <!-- /.box-header -->

                    <!-- we are adding the .panel class so bootstrap.js collapse plugin detects it -->

                    <div class="box-body" >

                    <div id="taskbox" class="box-body" style="height: 300px; overflow-y: auto">
                        <div class="lab_content_heading" id="SWS_04_2cccbf465cdc4dcc97adf10968a30097">Lab Description and Tasks <br><br>
                            <div class="lab_content_heading" id="SWS_04_39743d6c18d24b2fa376b520c2dac91a">Lab Setup <br><br>
                                <div class="lab_content_heading" id="task_200">Lab Overview <br><br>
                                    <div class="lab_content" id="SWS_04_9a541a6aef3c4bc2b9798c3b683f5dc7">
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The objective of this lab is to help students understand the Cross-Site Request Forgery (CSRF or XSRF) attack. A CSRF attack involves a victim user, a trusted site, and a malicious site. The victim user holds an active session with a trusted site while visiting a malicious site. The malicious site injects an HTTP request for the trusted site into the victim user session, causing damages.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">In this lab, students will be attacking a social networking web application using the CSRF attack. The open-source social networking application called&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;has countermeasures against CSRF, but we have turned them off for the purpose of this lab.</p>
                                    </div>
                                </div><div class="lab_content_heading" id="SWS_04_2e96dedc843a4d6994c9f97083fc398f">Environment Configuration <br><br>
                                    <div class="lab_content" id="SWS_04_bceb815ecb0a421fb1a063e7cff7a513">
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">You need to use our provided virtual machine image for this lab. In this lab, we need three things, which are already installed in the provided VM image:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">Ubuntu VM should be Ubuntu 12.04 or above with access to Internet.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><img src="https://labstudio.thothlab.org/c4x/ASU/SWS_04/asset/ubuntu-15.04.jpg" alt="" type="saveimage" target="[object Object]" preventdefault="function (){r.isDefaultPrevented=n}" stoppropagation="function (){r.isPropagationStopped=n}" stopimmediatepropagation="function (){r.isImmediatePropagationStopped=n}" isdefaultprevented="function t(){return!1}" ispropagationstopped="function t(){return!1}" isimmediatepropagationstopped="function t(){return!1}" height="447" width="816"></p>
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">(1) the Firefox web browser</p>
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">(2) the Apache web server, and</p>
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">(3) the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;web application.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">For the browser, we need to use the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">LiveHTTPHeaders</code>&nbsp;extension for Firefox to inspect the HTTP requests and responses. The prebuilt&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Ubuntu</code>&nbsp;VM image provided to you has already installed the Firefox web browser with the required<br style="text-rendering: optimizeLegibility; line-height: 1.4em;">extensions.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Starting the Apache Server</strong>. The Apache web server is also included in the pre-built&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Ubuntu</code>&nbsp;image. However, the web server is not started by default. You need to first start the web server using the following command:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">&nbsp;&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp; % sudo service apache2 start</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">The Elgg Web Application</strong>. We use an open-source web application called&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;in this lab.&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;is a web-based social-networking application. It is already set up in the pre-built&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Ubuntu</code>&nbsp;VM image. We have also created several user accounts on the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;server and the credentials are given below.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><img src="https://labstudio.thothlab.org/c4x/ASU/SS08/asset/table03.png" alt="" type="saveimage" target="[object Object]" preventdefault="function (){r.isDefaultPrevented=n}" stoppropagation="function (){r.isPropagationStopped=n}" stopimmediatepropagation="function (){r.isImmediatePropagationStopped=n}" isdefaultprevented="function t(){return!1}" ispropagationstopped="function t(){return!1}" isimmediatepropagationstopped="function t(){return!1}" style="text-rendering: optimizeLegibility; border: 0px; margin: 0px; padding: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;" height="200" width="353"></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Configuring DNS</strong>. We have configured the following URLs needed for this lab. To access the URLs , the Apache server needs to be started first:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><img src="https://labstudio.thothlab.org/c4x/ASU/SS08/asset/table04.png" alt="" type="saveimage" target="[object Object]" preventdefault="function (){r.isDefaultPrevented=n}" stoppropagation="function (){r.isPropagationStopped=n}" stopimmediatepropagation="function (){r.isImmediatePropagationStopped=n}" isdefaultprevented="function t(){return!1}" ispropagationstopped="function t(){return!1}" isimmediatepropagationstopped="function t(){return!1}" style="text-rendering: optimizeLegibility; border: 0px; margin: 0px; padding: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;" height="78" width="664"></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The above URLs are only accessible from inside of the virtual machine, because we have modified the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/etc/hosts</code>&nbsp;file to map the domain name of each URL to the virtual machine's local IP address&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">(127.0.0.1)</code>. You may map any domain name to a particular IP address using&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/etc/hosts</code>. For example you can map&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">http://www.example.com</code>&nbsp;to the local IP address by appending the following entry to&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/etc/hosts.</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp; 127.0.0.1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; www.example.com</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">If your web server and browser are running on two different machines, you need to modify&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/etc/hosts</code>&nbsp;on the browser's machine accordingly to map these domain names to the web server's IP address, not to&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">127.0.0.1</code>.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">Configuring Apache Server. In the pre-built VM image, we use Apache server to host all the web sites used in the lab. The name-based virtual hosting feature in Apache could be used to host several web sites (or URLs) on the same machine. A configuration file named&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">default</code>&nbsp;in the directory "<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/etc/apache2/sites-available</code>" contains the necessary directives for the configuration:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">1. The directive "<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">NameVirtualHost *</code>" instructs the web server to use all IP addresses in the machine (some machines may have multiple IP addresses).</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">2. Each web site has a&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">VirtualHost</code>&nbsp;block that specifies the URL for the web site and directory in the file system that contains the sources for the web site. For example, to configure a web site with URL&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">http://www.example1.com</code>&nbsp;with sources in directory&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/var/www/Example_1/</code>, and to configure a web site with URL&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">http://www.example2.com</code>&nbsp;with sources in directory<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;/var/www/Example_2/</code>, we use the following blocks:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&lt;VirtualHost *&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; ServerName http://www.example1.com</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; DocumentRoot /var/www/Example_1/</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&lt;/VirtualHost&gt;</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&lt;VirtualHost *&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; ServerName http://www.example2.com</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; DocumentRoot /var/www/Example_2/</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&lt;/VirtualHost&gt;</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">You may modify the web application by accessing the source in the mentioned directories. For example, with the above configuration, the web application&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">http://www.example1.com</code>&nbsp;can be changed by modifying the sources in the directory<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/var/www/Example_1/.</code></p>
                                    </div>
                                </div><div class="lab_content_heading" id="SWS_04_5b3fc4207ce1426ca8d44cfea820b293">Background for CSRF Attacks <br><br>
                                    <div class="lab_content" id="SWS_04_622ff1223643499e8b1e5b2f8b6cebfb">
                                        <p style="font-size: 16px; line-height: 25.6000003814697px;">A CSRF attack involves three actors: a trusted site (<code>Elgg</code>), a victim user of the trusted site, and a malicious site. The victim user simultaneously visits the malicious site while holding an active session with the trusted site. The attack involves the following sequence of steps:</p>
                                        <p style="font-size: 16px; line-height: 25.6000003814697px;">1. The victim user logs into the trusted site using his/her username and password, and thus creates a new<br>session.<br>2. The trusted site stores the session identifier for the session in a cookie in the victim user's web browser.<br>3. The victim user visits a malicious site.<br>4. The malicious site's web page sends a request to the trusted site from the victim user's browser. This<br>request is a cross-site request, because the site from where the request is initiated is different from the<br>site where the request goes to.<br>5. By design, web browsers automatically attach the session cookie to to the request, even if it is a<br>cross-site request.<br>6. The trusted site, if vulnerable to CSRF, may process the malicious request forged by the attacker web<br>site, because it does not know whether the request is a forged cross-site request or a legitimate one.</p>
                                        <p style="font-size: 16px; line-height: 25.6000003814697px;">The malicious site can forge both HTTP GET and POST requests for the trusted site. Some HTML tags such as&nbsp;<code>img</code>,&nbsp;<code>iframe</code>,&nbsp;<code>frame</code>, and&nbsp;<code>form</code>&nbsp;have no restrictions on the URL that can be used in their attribute. HTML&nbsp;<code>img</code>,&nbsp;<code>iframe</code>, and&nbsp;<code>frame</code>&nbsp;can be used for forging GET requests. The HTML&nbsp;<code>form</code>&nbsp;tag can be used for forging POST requests. Forging GET requests is relatively easier, as it does not even need the help of JavaScript; forging POST requests does need JavaScript. Forging GET requests is relatively easier, as it does not even need the help of JavaScript; forging POST requests does need JavaScript. Since&nbsp;<code>Elgg</code>&nbsp;only uses POST, the tasks<br>in this lab will only involve HTTP POST requests.</p>
                                        <p style="font-size: 16px; line-height: 25.6000003814697px;"></p>
                                    </div>
                                </div></div><div class="lab_content_heading" id="SWS_04_e8306157ef774a0493624e0a177044d5">Lab Tasks <br><br>
                                <div class="lab_content_heading" id="task_201">Task 1: CSRF Attack using GET Request <br><br>
                                    <div class="lab_content" id="SWS_04_552171a7cae74535815c6605d03c1a8c">
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">For the lab tasks, you will use two web sites that are locally setup in the virtual machine. The first web site is the vulnerable&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;site accessible at&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">www.csrflabelgg.com</code>&nbsp;inside the virtual machine. The second web site is the attacker's malicious web site that is used for attacking&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>. This web site is accessible via&nbsp;<a href="http://www.csrflabattacker.com" target="[object Object]">www.csrflabattacker.com</a><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;</code>inside the virtual machine.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">In this task, we need two people in the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;social network: Alice and Boby. Boby wants to become a friend to Alice, but Alice refuses to add Boby to her&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;friend list. Boby decides to use the CSRF attack to achieve his goal. He sends Alice an URL (via an email or a posting in&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>); Alice, curious about it, clicks on the URL, which leads her to Boby's web site:<a href="http://www.csrflabattacker.com" target="[object Object]">www.csrflabattacker.com</a>. Pretend that you are Boby, describe how you can construct the content of the web page, so as soon as Alice visits the web page, Boby is added to the friend list of Alice (assuming Alice has an active session with<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>).</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">To add a friend to the victim, we need to identify the Add Friend HTTP request, which is a GET request. In this task, you are not allowed to write JavaScript code to launch the CSRF attack. Your job is to make the attack successful as soon as Alice visits the web page, without even making any click on the page (hint: you can use the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">img</code>&nbsp;tag, which automatically triggers an HTTP GET request).</p>
                                    </div>
                                </div><div class="lab_content_heading" id="task_202">Task 2: CSRF Attack using POST Request <br><br>
                                    <div class="lab_content" id="SWS_04_9e0e4597d2e2461192bf0f150684cec7">
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">In this lab, we need two people in the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;social network: Alice and Boby. Alice is one of the developer of the SEED project, and she asks Boby to endorse the SEED project by adding the message "<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">I support SEED project!</code>" in his&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>profile, but Boby, who does not like hands-on lab activties, refuses to do so. Alice is very determined, and she wants to try the CSRF attack on Boby. Now, suppose you are Alice, your job is to launch such an attack.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">One way to do the attack is to post a message to Boby's&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;account, hoping that Boby will click the URL inside the message. This URL will lead Boby to your malicious web site&nbsp;<a href="http://www.csrflabattacker.com" target="[object Object]">www.csrflabattacker.com</a>, where you can launch the CSRF attack.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The objective of your attack is to modify the victim's profile. In particular, the attacker needs to forge a request to modify the profile information of the victim user of&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>. Allowing users to modify their profiles is a feature of&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>. If users want to modify their profiles, they go to the profile page of&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>, fill out a form, and then submit the form'sending a POST request to the server-side script&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/profile/edit.php</code>, which processes the request and does the profile modification.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The server-side script edit.php accepts both GET and POST requests, so you can use the same trick as that in Task 1 to achieve the attack. However, in this task, you are required to use the POST request. Namely, attackers (you) need to forge an HTTP POST request from the victim's browser, when the victim is visiting their malicious site. Attackers need to know the structure of such a request. You can observe the structure of the request, i.e the parameters of the request, by making some modifications to the profile and monitoring the request using&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">LiveHTTPHeaders</code>. You may see something similar to the following (unlike HTTP GET requests, which append parameters to the URL strings, the parameters of HTTP POST requests are included in the HTTP message body):</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">http://www.csrflabelgg.com/action/profile/edit</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">POST /action/profile/edit HTTP/1.1</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Host: www.csrflabelgg.com</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:23.0) Gecko/20100101 Firefox/23.0</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Accept-Language: en-US,en;q=0.5</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Accept-Encoding: gzip, deflate</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Referer: http://www.csrflabelgg.com/profile/elgguser1/edit</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Cookie: Elgg=p0dci8baqrl4i2ipv2mio3po05</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Connection: keep-alive</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Content-Type: application/x-www-form-urlencoded</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Content-Length: 642</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg_token=fc98784a9fbd02b68682bbb0e75b428b&amp;__elgg_ts=1403464813</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;name=elgguser1&amp;description=%3Cp%3Iamelgguser1%3C%2Fp%3E</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;accesslevel%5Bdescription%5D=2&amp;briefdescription= Iamelgguser1</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;accesslevel%5Bbriefdescription%5D=2&amp;location=US</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;accesslevel%5Blocation%5D=2&amp;interests=Football&amp;accesslevel%5Binterests%5D=2</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;skills=AndroidAppDev&amp;accesslevel%5Bskills%5D=2</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;contactemail=elgguser%40xxx.edu&amp;accesslevel%5Bcontactemail%5D=2</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;phone=3008001234&amp;accesslevel%5Bphone%5D=2</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;mobile=3008001234&amp;accesslevel%5Bmobile%5D=2</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;website=http%3A%2F%2Fwww.elgguser1.com&amp;accesslevel%5Bwebsite%5D=2</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&amp;twitter=hacker123&amp;accesslevel%5Btwitter%5D=2&amp;guid=39</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">After understanding the structure of the request, you need to be able to generate the request from your attacking web page using JavaScript code. To help you write such a JavaScript program, we provide the sample code in Figure 1 (in the appendix). You can use this sample code to construct your malicious web<br style="text-rendering: optimizeLegibility; line-height: 1.4em;">site for the CSRF attacks.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">Note: Please check the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">single quote</code>&nbsp;characters in the program. When copying and pasting the JavaScript program in Figure 1, single quotes are encoded into a different symbol. Replace the symbol with the correct single quote.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Questions</strong>. In addition to describing your attack in full details, you also need to answer the following questions in your report:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">?&nbsp;<em style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Question 1</em>: The forged HTTP request needs Boby's user id (guid) to work properly. If Alice targets Boby specifically, before the attack, she can find ways to get Boby's user id. Alice does not know Boby's&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;password, so she cannot log into Boby's account to get the information. Please describe how Alice can find out Boby's user id.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">?&nbsp;<em style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Question 2:</em>&nbsp;If Alice would like to launch the attack to anybody who visits her malicious web page. In this case, she does not know who is visiting the web page before hand. Can she still launch the CSRF attack to modify the victim's&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code></p>
                                    </div>
                                </div><div class="lab_content_heading" id="task_203">Task 3: Implementing a countermeasure for Elgg <br><br>
                                    <div class="lab_content" id="SWS_04_59345d1d750846ba80d4df1491b63085">
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;does have a built-in countermeasures to defend against the CSRF attack. We have commented out the countermeasures to make the attack work. CSRF is not difficult to defend against, and there are several common approaches:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">?&nbsp;<em style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Secret-token approach</em>: Web applications can embed a secret token in their pages, and all requests coming from these pages will carry this token. Because cross-site requests cannot obtain this token, their forged requests will be easily identified by the server.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><br style="text-rendering: optimizeLegibility; line-height: 1.4em;">?&nbsp;<em style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Referrer header approach</em>: Web applications can also verify the origin page of the request using the referrer header. However, due to privacy concerns, this header information may have already been filtered out at the client side.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The web application&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;uses secret-token approach. It embeds two parameters&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg_ts</code>&nbsp;and&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg _token</code>&nbsp;in the request as a countermeasure to CSRF attack. The two parameters are added to the HTTP message body for the POST requests and to the URL string for the HTTP GET requests.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;secret-token and timestamp in the body of the request:&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;adds security token and timestamp to all the user actions to be performed. The following HTML code is present in all the forms where user action is required. This code adds two new hidden parameters&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg_ts</code>&nbsp;and&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg _token</code>&nbsp;to the POST request:</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp;&nbsp; &lt;input type = "hidden" name = "__elgg_ts" value = "" /&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp;&nbsp; &lt;input type = "hidden" name = "__elgg_token" value = "" /&gt;</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg_ts</code>&nbsp;and&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg _token&nbsp;</code>are generated by the views&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">/default/input/securitytoken.php</code>&nbsp;module and added to the web page. The code snippet below shows how it is dynamically added to the web page.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; $ts = time();</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; $token = generate_action_token($ts);</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; echo elgg_view('input/hidden', array('name' =&gt; '__elgg_token', 'value' =&gt; $token));</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp; echo elgg_view('input/hidden', array('name' =&gt; '__elgg_ts', 'value' =&gt; $ts));</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;also adds the security tokens and timestamp to the JavaScript which can be accessed by</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp;&nbsp; elgg.security.token.__elgg_ts;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;&nbsp;&nbsp; elgg.security.token.__elgg_token;</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;security token is a hash value (md5 message digest) of the site secret value (retrieved from database), timestamp, user sessionID and random generated session string. There by defending against the CSRF attack. The code below shows the secret token generation in&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">function generate_action_token($timestamp)</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">{</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$site_secret = get_site_secret();</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$session_id = session_id();</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">// Session token</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$st = $_SESSION['__elgg_session'];</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if (($site_secret) &amp;&amp; ($session_id))</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">{</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">return md5($site_secret . $timestamp . $session_id . $st);</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">return FALSE;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The PHP function&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">session_id()</code>&nbsp;is used to get or set the session id for the current session. The below code snippet shows random generated string for a given session&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">__elgg_session</code>&nbsp;apart from public user Session ID.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">.........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">// Generate a simple token (private from potentially public session id)</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if (!isset($_SESSION['__elgg_session'])) {</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$_SESSION['__elgg_session'] = ElggCrypto::getRandomString(32,ElggCrypto::CHARS_HEX);</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Elgg secret-token validation</strong>: The elgg web application validates the generated token and timestamp to defend against the CSRF attack. Every user action calls&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">validate_action_token</code>&nbsp;function and this function validates the tokens. If tokens are not present or invalid, the action will be denied and the user will be redirected.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">The below code snippet shows the function&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">validate_action_token</code>.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">function validate_action_token($visibleerrors = TRUE, $token = NULL, $ts = NULL)</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">{</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if (!$token) {</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$token = get_input('__elgg_token');</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if (!$ts) {$ts = get_input('__elgg_ts');</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$session_id = session_id();</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if (($token) &amp;&amp; ($ts) &amp;&amp; ($session_id)) {</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">// generate token, check with input and forward if invalid</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$required_token = generate_action_token($ts);</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">// Validate token</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if ($token == $required_token) {</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">if (_elgg_validate_token_timestamp($ts)) {</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">// We have already got this far, so unless anything</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">// else says something to the contrary we assume we're ok</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">$returnval = true;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Else {</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">register_error(elgg_echo('actiongatekeeper:tokeninvalid'));</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">........</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em;"><code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">}</code></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">Turn on countermeasure: To turn on the countermeasure, please go to the directory&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">elgg/engine/lib</code>&nbsp;and find the function action gatekeeper in the&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">actions.php</code>&nbsp;file. In function&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">action_gatekeeper</code>&nbsp;please comment out the "<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">return true</code>;" statement as specified in the code comments.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">Task</strong>: After turning on the countermeasure above, try the CSRF attack again, and describe your observation. Please point out the secret tokens in the HTTP request captured using&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">LiveHTTPHeaders</code>. Please explain why the attacker cannot send these secret tokens in the CSRF attack; what prevents them from<br style="text-rendering: optimizeLegibility; line-height: 1.4em;">finding out the secret tokens from the web page?</p>
                                    </div>
                                </div><div class="lab_content_heading" id="SWS_04_deed51da39d64dbea9e5e46cd6e6e823">Submission <br><br>
                                    <div class="lab_content" id="SWS_04_f669ad8d69f94ec3b8079f2399a4e097">
                                        <p style="text-rendering: optimizeLegibility; margin-top: 0px; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">You need to submit a detailed lab report to describe what you have done and what you have observed. Please provide details using&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">LiveHTTPHeaders</code>,&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Wireshark</code>, and/or screen shots. You also need to provide explanation to the observations that are interesting or surprising.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><strong style="text-rendering: optimizeLegibility; margin: 0px; padding: 0px; border: 0px; outline: 0px; font-family: inherit; font-size: inherit; font-style: inherit; font-variant: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline;">References</strong></p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;"><br style="text-rendering: optimizeLegibility; line-height: 1.4em;">[1]&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;documentation:&nbsp;<a href="http://docs.elgg.org/wiki/Main_Page" target="[object Object]">http://docs.elgg.org/wiki/Main_Page</a>.<br style="text-rendering: optimizeLegibility; line-height: 1.4em;">[2] JavaScript String Operations.&nbsp;<a href="http://www.hunlock.com/blogs/The_Complete_Javascript_Strings_Reference" target="[object Object]">http://www.hunlock.com/blogs/The_Complete_Javascript_Strings_Reference</a>.<br style="text-rendering: optimizeLegibility; line-height: 1.4em;">[3] Session Security&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>.<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">&nbsp;<a href="http://docs.elgg.org/wiki/Session_security" target="[object Object]">http://docs.elgg.org/wiki/Session_security</a></code>.<br style="text-rendering: optimizeLegibility; line-height: 1.4em;">[4] Forms + Actions&nbsp;<code style="text-rendering: optimizeLegibility; font-size: inherit; margin: 0px; border: 0px; outline: 0px; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c;">Elgg</code>&nbsp;<a href="http://learn.elgg.org/en/latest/guides/actions.html" target="[object Object]">http://learn.elgg.org/en/latest/guides/actions.html</a>.</p>
                                        <p style="text-rendering: optimizeLegibility; margin-right: 0px; margin-left: 0px; padding: 0px; border: 0px; outline: 0px; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 16px; font-stretch: inherit; vertical-align: baseline; color: #4c4c4c;">[5] PHP:Session id - Manual:&nbsp;<a href="http://www.php.net//manual/en/function.session-id.php" target="[object Object]">http://www.php.net//manual/en/function.session-id.php</a>.</p>
                                    </div>
                                </div><div class="lab_content_heading" id="SWS_04_cdec610541874429b93dddd3ead308bf">Sample Java Program <br><br>
                                    <div class="lab_content" id="SWS_04_82839dfde2e149ed96c57fa270866b32">
                                        <p><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">&lt;html&gt;&lt;body&gt;&lt;h1&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">This page forges an HTTP POST request.</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">&lt;/h1&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">&lt;script type="text/javascript"&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">function post(url,fields)</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">{</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">//create a &lt;form&gt; element.</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">var p = document.createElement("form");</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">//construct the form</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">p.action = url;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">p.innerHTML = fields;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">p.target = "_self";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">p.method = "post";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">//append the form to the current page.</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">document.body.appendChild(p);</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">//submit the form</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">p.submit();</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">function csrf_hack()</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">{</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">var fields;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">// The following are form entries that need to be filled out</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">// by attackers. The entries are made hidden, so the victim</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">// won't be able to see them.</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='name' value='elgguser1'&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='description' value=''&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='accesslevel[description]' value='2'&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='briefdescription' value=''&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='accesslevel[briefdescription]' value='2'&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='location' value=''&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='accesslevel[location]' value='2'&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">fields += "&lt;input type='hidden' name='guid' value='39'&gt;";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">var url = "http://www.example.com";</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">post(url,fields);</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">// invoke csrf_hack() after the page is loaded.</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">window.onload = function() { csrf_hack();}</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">&lt;/script&gt;</code><br style="text-rendering: optimizeLegibility; line-height: 1.4em; color: #4c4c4c; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;"><code style="text-rendering: optimizeLegibility; margin: 0px; border: 0px; outline: 0px; font-stretch: inherit; line-height: 1.4em; vertical-align: baseline; border-radius: 3px; color: #4c4c4c; background-color: #ffffff;">&lt;/body&gt;&lt;/html&gt;</code></p>
                                    </div>
                                </div></div></div>
                    </div></div>
                </div>

            </div>
            <div id="labenv" class="col-md-6 resizable">
                <div class="box box-solid" id="lab-environment">
                    <div class="box-header with-border">
                        <h3 class="box-title">Workspace</h3>
                        <button style="display: none;float: right;" id="showtask"  onclick="open_content();">Show Task</button>
                    </div>
                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#lab-env-topology-tab" data-toggle="tab" onclick="vis_canvas_redraw({{ $projectid }});">Topology</a></li>

                    </ul>
                    <div class="tab-content">
                        <div class="active tab-pane" id="lab-env-topology-tab" >
                            <div class="box-body" >
                                <table width="100%">
                                    <thead><tr><th>
                                            <button id="btn-vis-refresh" title="Refresh Topology" disabled style="float: left" onclick="vis_canvas_load_network_topology('{{ $projectid }}')"><i class="fa fa-refresh"></i></button>
                                            <p id="vis-refresh-loading" style="float:left; display: none;"> &nbsp; &nbsp; Loading...</p>
                                            <button id="btn-vis-openallconsole" title="Open All Consoles" style="float: left; display: none; background-color: lightblue" onclick="vis_canvas_open_all_consoles('{{ $projectid }}')"><i class="fa fa-window-restore"></i></button>
                                            <p id="vis-topology-selection" style="float: right">Selection: None</p></th></tr></thead>
                                    <tbody id="lab-env-topology"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
   

    <script src="{{ URL::asset('js/labsubmission.js') }}"></script>
    <script src="{{ URL::asset('js/labenv.js') }}"></script>
    <script src="{{ URL::asset('js/vis-canvas-utility.js') }}"></script>
    <script src="{{ URL::asset('js/icon-img-assets.js') }}"></script>
    <script src="{{ URL::asset('js/vis-canvas-network-topology.js') }}"></script>
    <script src="{{ URL::asset('packages/vis/dist/vis.min.js') }}"></script>

    <script type="text/javascript">
        document.domain = "thothlab.com";

        var dones = '{{ json_encode($dones,JSON_HEX_TAG) }}';
        var labid = '{{ $lab }}';
        var taskcount = '{{ $taskcount }}';
        


        $(document).ready(function() {

            $.getJSON( "/checktaskfinished",{

                "taskid": 104

            }, function( data ) {
                if(data[0].finished){
                    $("#bs-wizard-step-104").addClass('complete').children().attr('title','Finished');
                    document.getElementById("countdownall").innerHTML = "Submitted";
                }
            });
            $.getJSON( "/checktaskfinished",{

                "taskid": 105

            }, function( data ) {
                if(data[0].finished){
                    $("#bs-wizard-step-105").addClass('complete').children().attr('title','Finished');
                    document.getElementById("countdownall2").innerHTML = "Submitted";
                }
            });
//            $.getJSON( "/checktaskfinished",{
//
//                "taskid": 103
//
//            }, function( data ) {
//                if(data[0].finished){
//                    $("#bs-wizard-step-103").addClass('complete').children().attr('title','Finished');
//                    document.getElementById("countdownall3").innerHTML = "Submitted";
//                }
//            });
            var labenv_spliter = Split(['#labcontent', '#labenv'],
                {
                    sizes: [50, 50],
                    minSize: 300,
                    //elementStyle: {'height': 'calc(50% - 5px'},
                    //gutterStyle: function (dimension, gutterSize) { return {'flex-basis':  gutterSize + 'px'} },
                    gutterSize: 6,
                    cursor: 'col-resize',
                    onDrag: function () {
                        $('.gutter-horizontal').css('height', $('#labcontent').find('.panel').css('height'));
                    }
                });
            $('#taskbox').css('height',$(window).innerHeight()-175);
            $('.gutter').css('background-color', 'lavender');
            $('.gutter-horizontal').css('height', $('#labcontent').find('.panel').css('height'));

            if ($('.container-fluid').innerWidth() < 768) {
                $('.gutter').hide();
                $('#labcontent').removeAttr('style');
                $('#labenv').removeAttr('style');
            }

            $(window).resize(function() {
                if ($('#labcontent').css('display') !== 'none') {
                    if (($('.container-fluid').innerWidth() < 768) && (labenv_spliter !== undefined)) {
                        $('.gutter').hide();
                        $('#labcontent').removeAttr('style');
                        $('#labenv').removeAttr('style');
                    } else {
                        if ($('.gutter').css('display') === 'none') {
                            $('.gutter').show();
                            $('#labcontent').css('width', 'calc(50% - 3px)');
                            $('#labenv').css('width', 'calc(50% - 3px)');
                        }
                        $('#taskbox').css('height',$(window).innerHeight()-175);
                        $('.gutter-horizontal').css('height', $('#labcontent').find('.panel').css('height'));
                    }
                }
            });

//            $('.tooltip').tooltipster({
//                animation: 'fade',
//                delay: 200,
//                theme: 'tooltipster-punk',
//                trigger: 'click',
//                contentAsHTML: true,
//                interactive: true,
//            });

            //            var maxWidth = $('#labcontent').innerWidth();
//            $('#labcontent').resizable({handles: "e", maxWidth: maxWidth});

//            $('#labcontent').resize(function () {
//                if ($('.container-fluid').innerWidth() <= 768) {
//                    //$('.col-md-6').css('width', '100%');
//                    $('#labcontent').resizable({ disabled: true});
//                } else {
//                    if ($('#labcontent').innerWidth() === $('.container-fluid').innerWidth()) {
//                        $('.col-md-6').css('width', '');
//                    }
//                    $('#labcontent').resizable({
//                        disabled: false,
//                        maxWidth: maxWidth
//                    });
            //$('#labenv').css('width', Math.floor($('.container-fluid').innerWidth() - $('#labcontent').innerWidth() - 2));

//                }
//            });

            vis_canvas_load_network_topology( '{{ $projectid }}' );

        });
    </script>


@endsection


@section('javascript')

@endsection